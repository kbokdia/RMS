"use strict";(self.webpackChunkClient=self.webpackChunkClient||[]).push([[27],{1027:(E,_,c)=>{c.r(_),c.d(_,{CustomerModule:()=>j});var m=c(6895),u=c(3031),x=c(5861),y=c(8372),b=c(1884),v=c(9808),O=c(7963),A=c(3905),P=c(4004),t=c(1571),p=c(433),I=c(2792);let C=(()=>{class o{constructor(){this.prefix="RMS",this.getKey=e=>`${this.prefix}_${e}`||""}getValue(e){const n=localStorage.getItem(this.getKey(e))||"";return JSON.parse(n)}setValue(e,n){const r=this.getKey(e);return localStorage.setItem(r,JSON.stringify(n||""))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var g=c(782),f=c(7084),q=c(4850);function w(o,i){if(1&o&&(t.TgZ(0,"span",26),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.value.tags)}}function S(o,i){if(1&o){const e=t.EpF();t.ynx(0,15),t.TgZ(1,"mat-grid-list",16)(2,"mat-grid-tile",17)(3,"div",5),t._UZ(4,"span"),t.TgZ(5,"h3",18),t._uU(6),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"span",19),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.YNc(11,w,2,1,"span",20),t._UZ(12,"br"),t.TgZ(13,"span",21),t._uU(14),t.qZA()()(),t.TgZ(15,"mat-grid-tile",22)(16,"div")(17,"button",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.patchQuantity(a,-1))}),t.TgZ(18,"span",24),t._uU(19,"-"),t.qZA()(),t.TgZ(20,"span",25),t._uU(21),t.qZA(),t.TgZ(22,"button",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.patchQuantity(a,1))}),t.TgZ(23,"span"),t._uU(24,"+"),t.qZA()()()()(),t._UZ(25,"mat-divider"),t.BQk()}if(2&o){const e=i.$implicit;t.Q6J("formGroup",e),t.xp6(2),t.Q6J("rowspan","1"),t.xp6(2),t.ekj("item-isNonVeg",!e.value.isVeg)("item-isVeg",e.value.isVeg),t.xp6(2),t.hij("",e.value.name," "),t.xp6(3),t.Oqu(t.xi3(10,12,e.value.price,"INR")),t.xp6(2),t.Q6J("ngIf",e.value.tags),t.xp6(3),t.Oqu(e.value.description),t.xp6(1),t.Q6J("rowspan","1"),t.xp6(6),t.hij(" ",e.value.quantity," ")}}function U(o,i){if(1&o&&(t.TgZ(0,"mat-accordion",10),t.ynx(1),t.TgZ(2,"mat-expansion-panel",11)(3,"mat-expansion-panel-header")(4,"mat-panel-title",12),t._uU(5),t.ALo(6,"uppercase"),t.qZA()(),t.YNc(7,S,26,15,"ng-container",13),t.qZA(),t.BQk(),t._UZ(8,"div",14),t.qZA()),2&o){const e=i.$implicit;t.Q6J("formGroup",e),t.xp6(5),t.hij(" ",t.lcZ(6,3,e.value.category)," "),t.xp6(2),t.Q6J("ngForOf",e.controls.items.controls)}}function N(o,i){if(1&o&&(t.TgZ(0,"div",8),t.YNc(1,U,9,5,"mat-accordion",9),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.formArray.controls)}}let Z=(()=>{class o{constructor(e,n,r,a,s,l){this.fb=e,this.menuSvc=n,this.storageSvc=r,this.router=a,this.activatedRoute=s,this.localStorageSvc=l,this.panelOpenState=!1,this.quantity=1,this.alwaysExpanded=!1,this.title="MENU",this.selectedItems=0,this.selectedItemTotalCost=0,this.showPriceSnackBar=!0}ngOnInit(){var e=this;return(0,x.Z)(function*(){const n=yield(0,v.n)(e.menuSvc.getEnabledByCategories()),r=yield(0,A.z)(e.activatedRoute.queryParams);e.localStorageSvc.setValue("tableId",r?.tableid),e.formArray=e.fb.array(n?.data?.map(a=>o.CreateFormForCategories(e.fb,a))),e.formArray.valueChanges.pipe((0,y.b)(200),(0,P.U)(a=>a.flatMap(s=>s.items)),(0,b.x)()).subscribe(a=>{const s=a.filter(l=>(l?.quantity??0)>0);e.selectedItems=s.length,e.selectedItemTotalCost=s.reduce((l,d)=>l+(d?.price??0)*(d?.quantity??0),0)})})()}getItemGroup(e){return e.get("items")}patchQuantity(e,n){const a=Math.max(0,(e.value.quantity??0)+n);e.patchValue({quantity:a,cost:a*(e.value?.price??0)})}navigateToCart(){const n=this.formArray.getRawValue()?.flatMap(r=>r.items).filter(r=>r.quantity>0);this.storageSvc.setValue("SelectedItems",n),this.router.navigate(["customer","cart"])}static CreateFormForCategories(e,n){const r=e.nonNullable.array(n?.items?.map(s=>o.CreateFormForMenuItem(e,s)));return e.nonNullable.group({category:n.category,items:r})}static CreateFormForMenuItem(e,n){return e.nonNullable.group({id:n.id,name:n.name,categoryType:n.categoryType,price:n.price,description:n.description,imageUrl:n.imageUrl,isVeg:n.isVeg,status:n.status,quantity:n?.quantity??0,cost:n?.cost??0,tags:n.tags})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(p.qu),t.Y36(I.X),t.Y36(C),t.Y36(u.F0),t.Y36(u.gz),t.Y36(C))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-menu"]],inputs:{alwaysExpanded:"alwaysExpanded",title:"title"},decls:18,vars:10,consts:[[1,"sub-header"],["style","padding-bottom: 5rem;",4,"ngIf"],[1,"price-snackbar"],["cols","5","rowHeight","2rem"],["colspan","3",1,"item"],[1,"full-width"],["colspan","2",1,"item"],[1,"full-width",2,"text-align","right",3,"click"],[2,"padding-bottom","5rem"],[3,"formGroup",4,"ngFor","ngForOf"],[3,"formGroup"],[1,"card-bg"],[1,"expansion-title"],["formGroupName","items",3,"formGroup",4,"ngFor","ngForOf"],[2,"margin",".5rem"],["formGroupName","items",3,"formGroup"],["cols","5"],["colspan","3",1,"item",3,"rowspan"],[1,"item-title"],[1,"item-price"],["class","chip",4,"ngIf"],[1,"item-description"],["colspan","2",3,"rowspan"],[1,"item-button",3,"click"],[1,"move-top"],[1,"item-quantity"],[1,"chip"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"h3"),t._uU(2),t.qZA()(),t.YNc(3,N,2,1,"div",1),t.TgZ(4,"div",2)(5,"mat-grid-list",3)(6,"mat-grid-tile",4)(7,"div",5)(8,"span"),t._uU(9),t.qZA(),t.TgZ(10,"span"),t._uU(11," | "),t.qZA(),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"currency"),t.qZA()()(),t.TgZ(15,"mat-grid-tile",6)(16,"div",7),t.NdJ("click",function(){return n.navigateToCart()}),t._uU(17," View Cart "),t.qZA()()()()),2&e&&(t.xp6(2),t.hij(" ",n.title,""),t.xp6(1),t.Q6J("ngIf",n.formArray),t.xp6(1),t.ekj("inactive",n.selectedItemTotalCost<=0),t.xp6(5),t.AsE("",n.selectedItems," item",n.selectedItems>1?"s":"",""),t.xp6(4),t.Oqu(t.xi3(14,7,n.selectedItemTotalCost,"INR")))},dependencies:[m.sg,m.O5,g.Il,g.DX,f.pp,f.ib,f.yz,f.yK,q.d,p.JL,p.sg,p.x0,m.gd,m.H9],styles:['.card-bg[_ngcontent-%COMP%]{background-color:#e9edc9}.text-center[_ngcontent-%COMP%]{text-align:center}.full-width[_ngcontent-%COMP%]{width:100%}.expansion-title[_ngcontent-%COMP%]{font-weight:200;letter-spacing:2px}.sub-header[_ngcontent-%COMP%]{text-align:center;color:#d4a373;margin:10px}.item-isVeg[_ngcontent-%COMP%]{height:1rem;width:1rem;display:inline-block;margin:0 .25rem;border:2px solid green;vertical-align:middle;position:relative}.item-isVeg[_ngcontent-%COMP%]:after{content:" ";background-color:green;position:absolute;top:0;left:0;right:0;border:1px solid green;bottom:0;height:.25rem;width:.25rem;border-radius:5rem;margin:auto}.item-isNonVeg[_ngcontent-%COMP%]{height:1rem;width:1rem;display:inline-block;margin:0 .25rem;border:2px solid red;vertical-align:middle;position:relative}.item-isNonVeg[_ngcontent-%COMP%]:after{content:" ";background-color:red;position:absolute;top:0;left:0;right:0;border:1px solid red;bottom:0;height:.25rem;width:.25rem;border-radius:5rem;margin:auto}.item-title[_ngcontent-%COMP%]{letter-spacing:1px;display:inline;vertical-align:middle}.text-muted[_ngcontent-%COMP%]{color:gray}.item-price[_ngcontent-%COMP%]{font-size:.9rem}.item-description[_ngcontent-%COMP%]{color:#7d7c83;font-size:.7rem}.item-button[_ngcontent-%COMP%]{height:20px;width:20px;border:1px solid #d4a373;color:#fff;border-radius:5px;background-color:#d4a373;display:inline-grid;place-items:center}.item-button[_ngcontent-%COMP%] > .move-top[_ngcontent-%COMP%]{position:relative;top:-1px}.item-quantity[_ngcontent-%COMP%]{padding:5px}.price-snackbar[_ngcontent-%COMP%]{font-weight:700;background-color:#d4a373;padding:.75rem 1rem;border-radius:.5rem;position:fixed;bottom:.5rem;width:calc(100% - 1.25rem);transition:all .2s;transform:translateY(-1rem);color:#faebd7}.price-snackbar.inactive[_ngcontent-%COMP%]{transform:translateY(5rem)}.chip[_ngcontent-%COMP%]{margin-left:5px;font-size:10px;background-color:#d4a373;padding:2px 4px;border-radius:5px;color:#fff}']}),o})();var M=c(3091),h=c(9549),T=c(4144);const F=["inputNumber"];let G=(()=>{class o{constructor(e,n){this.fb=e,this._bottomSheetRef=n}ngOnInit(){this.formGroup=this.fb.nonNullable.group({phoneNumber:["",[p.kI.required,p.kI.pattern(/^\d{10}$/)]]})}closeForm(){this._bottomSheetRef.dismiss(this.formGroup.value?.phoneNumber||"")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(p.qu),t.Y36(M.oL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-place-order"]],viewQuery:function(e,n){if(1&e&&t.Gf(F,5),2&e){let r;t.iGM(r=t.CRH())&&(n.inputNumber=r.first)}},decls:8,vars:2,consts:[[1,"place-order-wrapper",2,"padding-bottom","5rem",3,"formGroup"],["appearance","fill",1,"full-width"],["matInput","","type","phone","formControlName","phoneNumber","placeholder","E.g., 9988445523"],[1,"btn-wrapper"],[3,"disabled","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),t._uU(3,"Phone Number"),t.qZA(),t._UZ(4,"input",2),t.qZA(),t.TgZ(5,"div",3)(6,"button",4),t.NdJ("click",function(){return n.closeForm()}),t._uU(7,"Place Order"),t.qZA()()()),2&e&&(t.Q6J("formGroup",n.formGroup),t.xp6(6),t.Q6J("disabled",!n.formGroup.valid))},dependencies:[h.KE,h.hX,T.Nt,p.Fj,p.JJ,p.JL,p.sg,p.u],styles:[".mat-bottom-sheet-container[_ngcontent-%COMP%], .bg-color[_ngcontent-%COMP%]{background-color:#fefae0}.place-order-wrapper[_ngcontent-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]{display:grid;place-items:center}.place-order-wrapper[_ngcontent-%COMP%]   .btn-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:8px}"]}),o})();var k=c(384);const Y=["inputTextArea"];function J(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"mat-grid-list",13)(1,"mat-grid-tile",14)(2,"div",5)(3,"span"),t._uU(4),t.qZA()()(),t.TgZ(5,"mat-grid-tile",15)(6,"div",16)(7,"div")(8,"button",17),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.patchQuantity(a,-1))}),t.TgZ(9,"span",18),t._uU(10,"-"),t.qZA()(),t.TgZ(11,"span",19),t._uU(12),t.qZA(),t.TgZ(13,"button",17),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.patchQuantity(a,1))}),t.TgZ(14,"span"),t._uU(15,"+"),t.qZA()()()()(),t.TgZ(16,"mat-grid-tile",20)(17,"div",21)(18,"span",22),t._uU(19),t.ALo(20,"currency"),t.qZA()()()()}if(2&o){const e=i.$implicit;t.xp6(4),t.Oqu(e.value.name),t.xp6(8),t.hij(" ",e.value.quantity," "),t.xp6(7),t.Oqu(t.xi3(20,3,e.value.cost,"INR"))}}function Q(o,i){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,J,21,6,"mat-grid-list",8),t.TgZ(2,"div",9)(3,"mat-form-field",10)(4,"mat-label"),t._uU(5,"Special Instructions"),t.qZA(),t._UZ(6,"textarea",11,12),t.qZA()()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.formArray.controls)}}const V=[{path:"menu",component:Z},{path:"cart",component:(()=>{class o{constructor(e,n,r,a,s,l){this.fb=e,this.storageSvc=n,this.orderApiSvc=r,this.router=a,this._bottomSheet=s,this.authService=l,this.panelOpenState=!0,this.quantity=1,this.totalCost=0,this.phoneNumber=""}ngOnInit(){this.selectedItems=this.storageSvc.getValue("SelectedItems"),this.selectedItems?(this.totalCost=this.selectedItems.reduce((e,n)=>e+(n?.cost??0),0),this.formArray=this.fb.array(this.selectedItems.map(e=>Z.CreateFormForMenuItem(this.fb,e))),this.formArray.valueChanges.pipe((0,y.b)(200),(0,b.x)()).subscribe(e=>{this.totalCost=e.filter(n=>(n.quantity??0)>0).reduce((n,r)=>n+(r?.cost??0),0)})):this.router.navigate(["customer/menu"])}patchQuantity(e,n){const a=Math.max(0,(e.value.quantity??0)+n);e.patchValue({quantity:a,cost:a*(e.value?.price??0)})}placeOrder(){var e=this;return(0,x.Z)(function*(){const n=e.inputTextArea?.nativeElement?.value??"",r=e.formArray.value.filter(l=>(l?.quantity??0)>0).map(l=>({menuId:l.id,quantity:l.quantity})),a=e.storageSvc.getValue("tableId");let s={instructions:n,mobile:e.authService.getUsername(),status:O.l.Pending,tableId:a,userId:e.authService.getUserId(),items:r};if(!s.mobile){const l=e._bottomSheet.open(G,{panelClass:"bg-color"}),d=yield(0,v.n)(l.afterDismissed());if(!d)return;s.mobile=d}try{const d=(yield(0,v.n)(e.orderApiSvc.save(s))).data?.orderId;e.storageSvc.setValue("SelectedItems",""),e.router.navigate(["customer/order"],{queryParams:{orderId:d}})}catch(l){console.error(l)}})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(p.qu),t.Y36(C),t.Y36(O.W),t.Y36(u.F0),t.Y36(M.ch),t.Y36(k.e))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-cart"]],viewQuery:function(e,n){if(1&e&&t.Gf(Y,5),2&e){let r;t.iGM(r=t.CRH())&&(n.inputTextArea=r.first)}},decls:16,vars:7,consts:[[1,"sub-header"],[4,"ngIf"],[1,"price-snackbar"],["cols","5","rowHeight","2rem"],["colspan","3",1,"item"],[1,"full-width"],["colspan","2",1,"item"],[1,"full-width",2,"text-align","right",3,"click"],["cols","10",4,"ngFor","ngForOf"],[2,"padding-bottom","5rem","padding-top","1rem"],["appearance","fill",1,"example-full-width"],["matInput","","placeholder","","rows","5"],["inputTextArea",""],["cols","10"],["colspan","5",1,"item"],["colspan","3"],[1,"full-width",2,"text-align","center"],[1,"item-button",3,"click"],[1,"move-top"],[1,"item-quantity"],["colspan","2"],[1,"full-width",2,"text-align","right"],[1,"item-price"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"h3"),t._uU(2,"CART"),t.qZA()(),t.YNc(3,Q,8,1,"div",1),t.TgZ(4,"div",2)(5,"mat-grid-list",3)(6,"mat-grid-tile",4)(7,"div",5)(8,"span"),t._uU(9," Total "),t.qZA(),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"currency"),t.qZA()()(),t.TgZ(13,"mat-grid-tile",6)(14,"div",7),t.NdJ("click",function(){return n.placeOrder()}),t._uU(15," Order "),t.qZA()()()()),2&e&&(t.xp6(3),t.Q6J("ngIf",n.formArray),t.xp6(1),t.ekj("inactive",n.totalCost<=0),t.xp6(7),t.Oqu(t.xi3(12,4,n.totalCost,"INR")))},dependencies:[m.sg,m.O5,h.KE,h.hX,g.Il,g.DX,T.Nt,m.H9],styles:[".card-bg[_ngcontent-%COMP%]{background-color:#e9edc9}.text-center[_ngcontent-%COMP%]{text-align:center}.full-width[_ngcontent-%COMP%]{width:100%}.expansion-title[_ngcontent-%COMP%]{font-weight:200;letter-spacing:2px}.sub-header[_ngcontent-%COMP%]{text-align:center;color:#d4a373;margin:10px}.item-title[_ngcontent-%COMP%]{letter-spacing:1px}.text-muted[_ngcontent-%COMP%]{color:gray}.item-price[_ngcontent-%COMP%]{font-size:.9rem}.item-description[_ngcontent-%COMP%]{color:#7d7c83;font-size:.7rem}.item-button[_ngcontent-%COMP%]{height:20px;width:20px;border:1px solid #d4a373;color:#fff;border-radius:5px;background-color:#d4a373;display:inline-grid;place-items:center}.item-button[_ngcontent-%COMP%] > .move-top[_ngcontent-%COMP%]{position:relative;top:-1px}.item-quantity[_ngcontent-%COMP%]{padding:5px}.price-snackbar[_ngcontent-%COMP%]{font-weight:700;background-color:#d4a373;padding:.75rem 1rem;border-radius:.5rem;position:fixed;bottom:.5rem;width:calc(100% - 1.25rem);transition:all .2s;transform:translateY(-1rem);color:#fff}.price-snackbar.inactive[_ngcontent-%COMP%]{transform:translateY(5rem)}.example-full-width[_ngcontent-%COMP%]{width:100%}"]}),o})()},{path:"order",component:(()=>{class o{constructor(e){this.activateRoute=e}ngOnInit(){this.activateRoute.queryParams.subscribe(e=>this.orderId=e.orderId)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order"]],decls:6,vars:1,consts:[[2,"display","grid","place-items","center","height","50vh","text-align","center"],[2,"font-size","revert"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div")(2,"h2",1),t._uU(3," Your order has been received and is being prepared. You order number is "),t.qZA(),t.TgZ(4,"h1",1),t._uU(5),t.qZA()()()),2&e&&(t.xp6(5),t.hij(" ",n.orderId,""))}}),o})()}];let R=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.Bz.forChild(V),u.Bz]}),o})();var z=c(6585);let j=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.ez,R,z.M,p.UX]}),o})()}}]);